# InfluenceFlow

Проект: Telegram-бот “InfluenceFlow”

Цель: разработать Java-приложение с графическим интерфейсом или Telegram-ботом, взаимодействующим с реляционной базой данных PostgreSQL.
Проект засчитывается как итоговая работа по дисциплинам «Базы данных» и «Системный подход в разработке ПО».

1. Общие сведения

Название: InfluenceFlow
Тип проекта: Telegram-бот на Java + база данных PostgreSQL
Инструменты:

Java 17+

Maven (или Gradle)

TelegramBots API (rubenlagus/TelegramBots)

JDBC (без ORM-фреймворков)

PostgreSQL

DBeaver/MySQL Workbench/Data Modeler — для проектирования схемы БД

Eclipse или IntelliJ IDEA Community

2. Описание проекта

Telegram-бот автоматизирует управление маркетинговыми кампаниями с блогерами: регистрация участников, получение заданий, отправка публикаций, проверка ссылок, сбор метрик и расчёт выплат.

Система поддерживает две роли:

Администратор (бренд/менеджер): создаёт кампании и задания, модерирует сдачи, формирует выплаты.

Блогер (Creator): регистрируется, выбирает задания, сдаёт ссылки на публикации, отправляет статистику (просмотры, лайки, комментарии).

3. Требования к функционалу
3.1. Для блогеров

/start — регистрация и ввод контактных данных.

/campaigns — просмотр активных кампаний и заданий.

Команда “Сдать ссылку” — бот принимает URL публикации и валидирует по регулярным выражениям:

Instagram: https?://(www\.)?instagram\.com/reel/[A-Za-z0-9_-]+/?

TikTok: https?://(www\.)?tiktok\.com/@[A-Za-z0-9._]+/video/\d+/?

YouTube Shorts, Reddit — аналогично.

/mymetrics — ввод метрик в формате views=1234 likes=56 comments=7.
Парсинг выполняется регуляркой (\w+)=(\d+).

Получение уведомлений о статусе модерации и выплатах.

3.2. Для администратора

/moderate — просмотр и утверждение/отклонение сдач (PENDING → APPROVED/REJECTED).

/payouts — формирование выплат по утверждённым публикациям.

/reports — агрегированные отчёты по кампаниям (по числу сдач, суммам, метрикам).

4. Требования к базе данных (PostgreSQL)

Минимум 7 таблиц, связанных внешними ключами:

№	Таблица	Назначение
1	tg_user	- учётные записи Telegram-пользователей (админ/блогер)
2	creator	- профили блогеров
3	campaign - маркетинговые кампании
4	task -	задания в рамках кампаний
5	submission -	сданные публикации
6	post_metric	- статистика по публикациям
7	payout	- начисления и выплаты блогерам
8	payout_item - (опционально)	детализация выплат по сдачам
Ключевые ограничения

submission.status ∈ {PENDING,APPROVED,REJECTED}

Уникальность пары (task_id, creator_id)

CHECK-ограничения для сумм, просмотров и т.д.

Все таблицы приведены к 3-й нормальной форме (НФБК)

В базе должно быть не менее 5 тестовых записей в каждой таблице.

5. Архитектура приложения

Пакеты:

/src/main/java/com/influenceflow/
├── bot/InfluenceFlowBot.java
├── dao/ (классы доступа к данным, JDBC)
├── model/ (POJO-сущности)
├── service/ (бизнес-логика, валидации)
├── util/RegexValidator.java
└── config/Db.java (пул соединений)


Слои:

DAO — SQL-операции через JDBC

Service — обработка логики (валидация ссылок, статусы, начисления)

Bot — Telegram API, взаимодействие с пользователем

Config — подключение к PostgreSQL

6. UML и модели

Use Case-диаграмма: акторы Admin, Creator; кейсы UC1–UC7.

ER-диаграмма: сущности и связи таблиц (1-N, N-1).

Диаграмма классов Java-приложения: основные DAO, сервисы, модели.

## Реализация проекта

Репозиторий содержит рабочий каркас Telegram-бота на Java 17 с доступом к PostgreSQL через JDBC. Основные компоненты расположены в `src/main/java/com/influenceflow/` и разделены на пакеты `bot`, `config`, `dao`, `model`, `service`, `util`.

* `InfluenceFlowBot` обрабатывает пользовательские команды `/start`, `/campaigns`, `/submit`, `/mymetrics`, а также административные `/moderate`, `/approve`, `/reject`.
* Сервисы (`CreatorService`, `CampaignService`, `SubmissionService`, `PayoutService`) инкапсулируют бизнес-логику регистрации, выдачи заданий, модерации сдач и формирования выплат.
* DAO-слой реализует CRUD-операции через чистый JDBC, конфигурация подключения задаётся в `config/Db.java` переменными окружения `DB_URL`, `DB_USER`, `DB_PASS`.
* В `src/main/resources/db/` размещены SQL-скрипты `schema.sql` и `data.sql` с полной схемой из 8 таблиц и тестовыми данными (не менее 5 записей в каждой таблице).
* Класс `RegexValidator` обеспечивает проверку ссылок Instagram/TikTok/YouTube/Reddit и парсинг метрик в формате `views=123 likes=45 comments=6`; для него добавлены модульные тесты (`RegexValidatorTest`).

### Сборка и запуск

```bash
mvn package
java -jar target/influenceflow-1.0.0.jar
```

Перед запуском задайте переменные окружения: `DB_URL`, `DB_USER`, `DB_PASS`, `BOT_TOKEN`, `BOT_USERNAME`, `BOT_ADMIN`.

Для развёртывания схемы выполните:

```bash
psql "$DB_URL" -f src/main/resources/db/schema.sql
psql "$DB_URL" -f src/main/resources/db/data.sql
```

### Тестирование

Запуск модульных тестов выполняется командой `mvn test`.

7. Тестирование

Юнит-тесты (JUnit):

Проверка валидации URL и формата метрик.

Регистрация блогера с корректными/ошибочными данными.

Интеграционные тесты (с PostgreSQL):

Полный сценарий: регистрация → сдача → модерация → выплата.

Проверка ограничений и связей FK.

Ручные тесты (Telegram):

Позитивные и негативные сценарии для всех команд.

8. Развёртывание

Среда: РЕД ОС или Linux-ВМ.

Установить PostgreSQL и Java 17+.

Задать переменные окружения:
DB_URL, DB_USER, DB_PASS, BOT_TOKEN, BOT_USERNAME.

Собрать проект (mvn package), запустить java -jar influenceflow.jar.

Проверить работу с ботом через Telegram.

9. Отчётность (по требованиям зачёта)

В отчёт включить:

Описание предметной области и Use Case-диаграмму.

ER-модель и описание атрибутов.

SQL-скрипты DDL + тестовые INSERT.

UML-диаграмму классов приложения.

Примерные команды/диалоги в боте.

План и результаты тестирования.

Скриншоты работы и развёртывания.

Заключение и выводы.

10. Критерии приёмки

Полная реализация схемы БД (≥7 таблиц, 3НФ).

Java-приложение или Telegram-бот, работающий через JDBC без ORM.

Наличие тестовых данных и демонстрации CRUD-операций.

Реализованы регулярные выражения для проверки пользовательского ввода.

Отчёт оформлен по академическим требованиям с UML-диаграммами и кодом.
